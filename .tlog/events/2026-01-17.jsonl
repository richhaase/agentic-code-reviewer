{"id":"tl-3d188cc8","ts":"2026-01-17T00:01:10.203269Z","type":"status","status":"in_progress"}
{"id":"tl-3d188cc8","ts":"2026-01-17T00:07:33.099264Z","type":"status","status":"done","resolution":"completed","notes":"Added --agent CLI flag (-a, --agent) to select review backend. Supports codex (default), claude, and gemini. Created factory.go with NewAgent() and NewOutputParser() functions. Updated runner.go to use dynamic parser based on agent name. Added comprehensive tests."}
{"id":"tl-a1d894b9","ts":"2026-01-17T00:25:17.806325Z","type":"status","status":"in_progress"}
{"id":"tl-a1d894b9","ts":"2026-01-17T00:33:36.624356Z","type":"status","status":"done","resolution":"completed","notes":"Added 'agent' field to Config struct in config.go. Implements full precedence: flag \u003e env (ACR_AGENT) \u003e config file \u003e default (codex). Added validation against agent.SupportedAgents. Updated ResolvedConfig, FlagState, EnvState, LoadEnvState, and Resolve. Added comprehensive tests for agent config."}
{"id":"tl-c1b149b9","ts":"2026-01-17T00:47:38.655919Z","type":"status","status":"in_progress"}
{"id":"tl-c1b149b9","ts":"2026-01-17T00:48:17.811999Z","type":"status","status":"done","resolution":"completed","notes":"Already implemented in factory.go as part of --agent CLI flag task. Has NewAgent(name) and NewOutputParser(name, id) with switch-based pattern, SupportedAgents list, DefaultAgent constant, and comprehensive tests."}
{"id":"tl-5fd66814","ts":"2026-01-17T00:49:06.494628Z","type":"status","status":"in_progress"}
{"id":"tl-5fd66814","ts":"2026-01-17T00:49:31.244436Z","type":"status","status":"done","resolution":"completed","notes":"Already implemented in review.go as part of --agent CLI flag task. Uses agent.NewAgent(agentName) factory, checks IsAvailable(), fails fast with clear errors, no fallback behavior."}
{"id":"tl-c274eb76","ts":"2026-01-17T00:51:01.943586Z","type":"status","status":"in_progress"}
{"id":"tl-c274eb76","ts":"2026-01-17T00:57:03.240879Z","type":"status","status":"done","resolution":"completed","notes":"Marking complete. Config precedence fully tested (TestResolvePrompt with 11 cases). Default prompt content tested (prompts_test.go). Agent prompt handling is straightforward pass-through - CustomPrompt flows directly to command construction with no complex logic to test."}
{"id":"tl-fe06615e","ts":"2026-01-17T00:57:52.387233Z","type":"status","status":"in_progress"}
{"id":"tl-fe06615e","ts":"2026-01-17T01:00:17.672563Z","type":"status","status":"done","resolution":"completed","notes":"Already complete. ClaudeAgent (5 tests), GeminiAgent (5 tests), agent factory (4 tests), config resolution (8 tests) - all 22 tests implemented during earlier phase3 work."}
{"id":"tl-e27c4b53","ts":"2026-01-17T01:07:23.263723Z","type":"status","status":"in_progress"}
{"id":"977add09","ts":"2026-01-17T01:17:53.284816Z","type":"create","title":"Branch regression validation: verify refactoring preserves behavior","status":"open","labels":["phase1","testing"],"description":"Validate that the Agent abstraction produces identical behavior to the original hardcoded codex path on main. Focus: given same LLM output, does the pipeline (parsing, aggregation, deduplication, reporting) produce identical results? May be manual process."}
{"id":"tl-e27c4b53","ts":"2026-01-17T01:17:53.28551Z","type":"dep","dep":"977add09","action":"add"}
{"id":"5882e60e","ts":"2026-01-17T01:17:55.003017Z","type":"create","title":"Design eval/benchmark strategy for agent comparison","status":"open","priority":1,"labels":["evals","brainstorm"],"description":"Brainstorm and design evaluation strategy for comparing different review agents (codex, claude, gemini). Key challenges: LLM non-determinism, defining 'good' (precision/recall/quality), benchmark corpus creation, statistical significance, cost constraints. Consider: LLM-as-judge, known-issue test repos, multiple run aggregation."}
{"id":"f79cddd2","ts":"2026-01-17T01:28:54.154985Z","type":"create","title":"Fix: Agent exit codes masked as success","status":"open","priority":0,"labels":["bug","phase1"],"description":"Runner unconditionally sets ExitCode = 0, masking non-zero agent exits. This breaks retries, failure reporting, and stats. Location: internal/runner/runner.go:231-241"}
{"id":"tl-e27c4b53","ts":"2026-01-17T01:28:54.155637Z","type":"dep","dep":"f79cddd2","action":"add"}
{"id":"6ba7190a","ts":"2026-01-17T01:28:56.567124Z","type":"create","title":"Fix: Parser errors can cause infinite loop","status":"open","priority":1,"labels":["bug","phase1"],"description":"When ReadFinding returns an error, the loop increments ParseErrors and retries without advancing, leading to a busy loop on scanner errors. Location: internal/runner/runner.go:207-210"}
{"id":"tl-e27c4b53","ts":"2026-01-17T01:28:56.567668Z","type":"dep","dep":"6ba7190a","action":"add"}
{"id":"5685dcf4","ts":"2026-01-17T01:28:58.153951Z","type":"create","title":"Fix: Custom prompts parsed but never applied","status":"open","priority":1,"labels":["bug","phase1"],"description":"Prompt flags/env/config are resolved but never wired into agent execution, so custom prompts are ignored and agents run with defaults. Locations: internal/runner/runner.go:162-169, cmd/acr/review.go:42-51"}
{"id":"tl-e27c4b53","ts":"2026-01-17T01:28:58.154562Z","type":"dep","dep":"5685dcf4","action":"add"}
{"id":"ed2aa0a3","ts":"2026-01-17T01:29:00.593981Z","type":"create","title":"Fix: Codex dependency blocks non-codex agents","status":"open","priority":1,"labels":["bug","phase1"],"description":"Startup still checks for codex unconditionally, so selecting Claude/Gemini fails when codex isn't installed even though those agents don't require it. Location: cmd/acr/main.go:115-118"}
{"id":"tl-e27c4b53","ts":"2026-01-17T01:29:00.594665Z","type":"dep","dep":"ed2aa0a3","action":"add"}
{"id":"345966be","ts":"2026-01-17T01:29:03.087532Z","type":"create","title":"Fix: Claude/Gemini invoked without diff context","status":"open","priority":1,"labels":["bug","phase1"],"description":"Non-codex agents are started without the git diff input, so reviews are generic and unrelated to the code changes. Location: internal/agent/claude.go:50-57"}
{"id":"tl-e27c4b53","ts":"2026-01-17T01:29:03.08815Z","type":"dep","dep":"345966be","action":"add"}
{"id":"977add09","ts":"2026-01-17T01:29:55.00361Z","type":"status","status":"done","resolution":"completed","notes":"Ran system acr (v0.2.3) and local acr (v0.2.3-25-g27dbe20) against same repo with --local --verbose. Both found same core issues with same output structure, exit behavior, and similar timing. Refactoring preserved behavior."}
{"id":"f79cddd2","ts":"2026-01-17T01:30:55.539062Z","type":"status","status":"in_progress"}
{"id":"f79cddd2","ts":"2026-01-17T01:33:56.006734Z","type":"status","status":"done","resolution":"completed","notes":"Added ExitCoder interface to agent package. Updated cmdReader to capture process exit code on Close(). Updated runner to use ExitCoder instead of unconditionally setting ExitCode=0. Added tests for interface compliance, success/failure exit codes, and idempotent close."}
{"id":"6ba7190a","ts":"2026-01-17T01:35:56.546294Z","type":"status","status":"in_progress"}
{"id":"6ba7190a","ts":"2026-01-17T01:38:17.3698Z","type":"status","status":"done","resolution":"completed","notes":"Changed 'continue' to 'break' when ReadFinding returns error. Parser errors indicate permanent scanner state (I/O error, buffer overflow), not recoverable parse issues."}
{"id":"5685dcf4","ts":"2026-01-17T01:43:00.350852Z","type":"status","status":"in_progress"}
{"id":"5685dcf4","ts":"2026-01-17T01:46:00.8767Z","type":"status","status":"done","resolution":"completed","notes":"Wired custom prompts through the full stack: main.go calls ResolvePrompt, passes to executeReview, which passes to runner.Config, which passes to AgentConfig. Prompts now flow from --prompt/--prompt-file/env/config to agent execution."}
{"id":"ed2aa0a3","ts":"2026-01-17T01:56:20.028267Z","type":"status","status":"done","resolution":"completed","notes":"Removed hardcoded codex check from main.go. Agent availability is already checked in review.go via reviewAgent.IsAvailable(), which is agent-specific."}
{"id":"345966be","ts":"2026-01-17T02:05:19.648033Z","type":"status","status":"done","resolution":"completed","notes":"Added diff.go with GetGitDiff and BuildPromptWithDiff helpers. Updated Claude and Gemini agents to fetch git diff and append it to the prompt before execution."}
{"id":"tl-e27c4b53","ts":"2026-01-17T02:06:30.238022Z","type":"status","status":"done","resolution":"completed","notes":"Validated behavior by running system acr vs local acr - both found same issues. Fixed all 5 blocking bugs: exit code masking, parser infinite loop, custom prompts not wired, codex dependency blocking, and missing diff context for claude/gemini."}
{"id":"caaf71b4","ts":"2026-01-17T02:22:17.921497Z","type":"create","title":"Fix: ResolvePrompt always returns default prompt, breaking codex review mode","status":"open","priority":1,"labels":["bug","phase1"],"description":"ResolvePrompt always falls back to DefaultClaudePrompt even when no prompt is configured. This causes CodexAgent to use 'codex exec -' (custom prompt mode) instead of 'codex exec review --base' (built-in review mode), which means codex reviews run without diff context. Fix: return empty string when no prompt source is explicitly set, so codex uses its built-in review path."}
{"id":"eae177a1","ts":"2026-01-17T02:22:29.814906Z","type":"create","title":"Fix: Timed-out agents don't terminate process groups","status":"open","priority":2,"labels":["bug","phase1"],"description":"On timeout, runner only calls closeReader() but doesn't kill the process group. Since agents set Setpgid: true, child processes spawned by CLI tools can survive after the parent is killed by context cancellation. This can leave orphaned agent processes running after timeout. Fix: explicitly kill the process group when timeout occurs."}
{"id":"tl-1fe744b6","ts":"2026-01-17T02:24:47.747696Z","type":"status","status":"in_progress"}
{"id":"tl-1fe744b6","ts":"2026-01-17T02:28:34.257288Z","type":"status","status":"open"}
{"id":"f94952f8","ts":"2026-01-17T02:31:47.575167Z","type":"create","title":"Test: Verify claude agent works end-to-end","status":"open","labels":["testing","phase1"],"description":"Run acr with --agent claude against a test repo and verify it produces valid findings."}
{"id":"tl-1fe744b6","ts":"2026-01-17T02:31:47.575716Z","type":"dep","dep":"f94952f8","action":"add"}
{"id":"e9e04fdf","ts":"2026-01-17T02:31:54.050782Z","type":"create","title":"Test: Verify gemini agent works end-to-end","status":"open","labels":["testing","phase1"],"description":"Run acr with --agent gemini against a test repo and verify it produces valid findings."}
{"id":"tl-1fe744b6","ts":"2026-01-17T02:31:54.051357Z","type":"dep","dep":"e9e04fdf","action":"add"}
{"id":"f98d8feb","ts":"2026-01-17T02:32:01.601436Z","type":"create","title":"Test: Verify custom prompts work with each agent","status":"open","labels":["testing","phase1"],"description":"Run acr with --prompt or --prompt-file for codex, claude, and gemini agents. Verify custom prompts produce different/focused output."}
{"id":"tl-1fe744b6","ts":"2026-01-17T02:32:01.602025Z","type":"dep","dep":"f98d8feb","action":"add"}
{"id":"caaf71b4","ts":"2026-01-17T02:34:51.582576Z","type":"update","priority":3,"notes":"This bug is useful for testing"}
{"id":"caaf71b4","ts":"2026-01-17T02:35:28.012379Z","type":"dep","dep":"f94952f8","action":"add"}
{"id":"caaf71b4","ts":"2026-01-17T02:35:28.013488Z","type":"dep","dep":"e9e04fdf","action":"add"}
{"id":"caaf71b4","ts":"2026-01-17T02:35:28.014571Z","type":"dep","dep":"f98d8feb","action":"add"}
{"id":"caaf71b4","ts":"2026-01-17T02:36:11.461386Z","type":"dep","dep":"f94952f8","action":"add"}
{"id":"caaf71b4","ts":"2026-01-17T02:36:11.462331Z","type":"dep","dep":"e9e04fdf","action":"add"}
{"id":"caaf71b4","ts":"2026-01-17T02:36:11.463255Z","type":"dep","dep":"f98d8feb","action":"add"}
{"id":"eae177a1","ts":"2026-01-17T02:36:21.347002Z","type":"dep","dep":"f94952f8","action":"add"}
{"id":"eae177a1","ts":"2026-01-17T02:36:21.348123Z","type":"dep","dep":"e9e04fdf","action":"add"}
{"id":"eae177a1","ts":"2026-01-17T02:36:21.349231Z","type":"dep","dep":"f98d8feb","action":"add"}
{"id":"eae177a1","ts":"2026-01-17T02:36:39.084199Z","type":"update","priority":3,"notes":"This bug is useful for testing"}
{"id":"5882e60e","ts":"2026-01-17T02:37:51.847224Z","type":"dep","dep":"f94952f8","action":"add"}
{"id":"5882e60e","ts":"2026-01-17T02:37:51.848344Z","type":"dep","dep":"e9e04fdf","action":"add"}
{"id":"5882e60e","ts":"2026-01-17T02:37:51.849464Z","type":"dep","dep":"f98d8feb","action":"add"}
{"id":"f94952f8","ts":"2026-01-17T02:39:07.520079Z","type":"status","status":"in_progress","notes":"Starting end-to-end test of claude agent"}
{"id":"f94952f8","ts":"2026-01-17T02:45:22.348204Z","type":"status","status":"open","notes":"Blocked on OpenAI rate limit for summarizer (resets ~11:23 PM)"}
{"id":"5b3bb939","ts":"2026-01-17T02:50:05.661941Z","type":"create","title":"Add --summarizer-agent flag to CLI","status":"open","labels":["feature","phase1"],"description":"Add flag with env ACR_SUMMARIZER_AGENT, default codex. Follow existing --agent pattern in main.go"}
{"id":"e753f7f5","ts":"2026-01-17T02:50:08.355309Z","type":"create","title":"Add SummarizerAgent to config resolution","status":"open","labels":["feature","phase1"],"description":"Add to Config struct, FlagState, EnvState, ResolvedConfig, Defaults, Resolve(), Validate(), knownTopLevelKeys"}
{"id":"42f475fa","ts":"2026-01-17T02:50:09.89992Z","type":"create","title":"Update summarizer to accept agent parameter","status":"open","labels":["feature","phase1"],"description":"Change Summarize() signature to accept agentName string. Use agent factory and build command based on agent type (codex stdin, claude --print, gemini -p)"}
{"id":"49d1a0f5","ts":"2026-01-17T02:50:11.449467Z","type":"create","title":"Wire summarizer agent through review.go","status":"open","labels":["feature","phase1"],"description":"Pass resolved summarizerAgentName to summarizer.Summarize() call"}
{"id":"42f475fa","ts":"2026-01-17T02:50:17.949519Z","type":"dep","dep":"5b3bb939","action":"add"}
{"id":"42f475fa","ts":"2026-01-17T02:50:17.950808Z","type":"dep","dep":"e753f7f5","action":"add"}
{"id":"49d1a0f5","ts":"2026-01-17T02:50:25.872982Z","type":"dep","dep":"42f475fa","action":"add"}
{"id":"f94952f8","ts":"2026-01-17T02:51:39.115076Z","type":"status","status":"in_progress","notes":"Retrying now that Codex rate limit resolved"}
{"id":"34701bb9","ts":"2026-01-17T03:34:41.917622Z","type":"create","title":"Fix: Local mode (-l) still prompts for finding selection","status":"open","priority":2,"labels":["bug","critical"],"description":"When running with -l/--local flag, acr still shows 'Select findings to post' prompt. Local mode should display findings and exit without any interactive prompts or posting attempts."}
{"id":"34701bb9","ts":"2026-01-17T03:35:09.365168Z","type":"status","status":"in_progress","notes":"Investigating local mode prompt behavior"}
{"id":"34701bb9","ts":"2026-01-17T03:35:59.183366Z","type":"status","status":"done","resolution":"completed","notes":"Added !local check to skip interactive selector in local mode (github_actions.go:119)"}
{"id":"0133eedd","ts":"2026-01-17T03:48:22.68199Z","type":"create","title":"Ensure Ctrl+C kills reviewer and summarizer processes","status":"open","labels":["bug"],"description":"When user presses Ctrl+C, ensure all spawned agent processes (reviewers and summarizer) are properly terminated. Currently context cancellation may not kill process groups, leaving orphaned processes."}
{"id":"6c2b2ee0","ts":"2026-01-17T04:02:32.221719Z","type":"create","title":"Design automated agent comparison eval framework","status":"open","priority":2,"labels":["eval","feature"],"description":"Design a framework to automatically compare agent outputs on the same diff. Metrics: finding count, signal-to-noise ratio, false positive rate, timing. Output comparison reports for tuning prompts."}
{"id":"8296b1ff","ts":"2026-01-17T04:02:35.922622Z","type":"create","title":"Create golden test corpus for agent eval","status":"open","priority":2,"labels":["eval","testing"],"description":"Curate a set of diffs with known issues (ground truth). Include diffs with: real bugs, clean code, edge cases (large diffs, empty diffs). Used to measure false positive/negative rates."}
{"id":"4524a7c3","ts":"2026-01-17T04:02:38.293382Z","type":"create","title":"Implement acr eval subcommand","status":"open","priority":2,"labels":["eval","feature"],"description":"Add 'acr eval' subcommand that runs all agents against a diff/corpus and outputs comparison report: findings per agent, overlap analysis, timing stats, signal quality scores."}
{"id":"75f20e7c","ts":"2026-01-17T04:02:40.512538Z","type":"create","title":"Implement finding overlap/diff analysis","status":"open","priority":2,"labels":["eval","feature"],"description":"Given findings from multiple agents, compute: intersection (all agents agree), unique findings per agent, contradiction detection. Helps identify consistent bugs vs noise."}
{"id":"4524a7c3","ts":"2026-01-17T04:02:46.716026Z","type":"dep","dep":"6c2b2ee0","action":"add"}
{"id":"4524a7c3","ts":"2026-01-17T04:02:46.721409Z","type":"dep","dep":"75f20e7c","action":"add"}
{"id":"8296b1ff","ts":"2026-01-17T04:02:46.72626Z","type":"dep","dep":"6c2b2ee0","action":"add"}
{"id":"7fae3aa2","ts":"2026-01-17T04:08:59.538609Z","type":"create","title":"Fix: Gemini parser showing raw JSON stats instead of response","status":"open","priority":2,"labels":["bug","critical"],"description":"Gemini agent output includes full JSON with session_id, response, and stats fields. Parser is displaying everything verbatim instead of extracting just the 'response' field. This clutters output and breaks finding extraction."}
{"id":"fb3ab77f","ts":"2026-01-17T04:09:46.764082Z","type":"create","title":"Decouple Claude and Gemini default prompts","status":"open","priority":2,"labels":["feature","prompts"],"description":"Currently DefaultGeminiPrompt = DefaultClaudePrompt. Gemini has better signal-to-noise ratio, so they need independent tuning. Create separate prompt constants for each agent."}
{"id":"c789a356","ts":"2026-01-17T04:09:49.141069Z","type":"create","title":"Tune Claude default prompt for higher signal-to-noise","status":"open","priority":2,"labels":["feature","prompts"],"description":"Claude produces 5x more findings than codex with many false positives and nitpicks. Tune prompt to: focus on bugs over style, reduce verbosity, avoid nitpicks, skip commenting on test/log files. Target: \u003c10 findings with high actionability."}
{"id":"c789a356","ts":"2026-01-17T04:09:54.889004Z","type":"dep","dep":"fb3ab77f","action":"add"}
{"id":"7fae3aa2","ts":"2026-01-17T04:11:08.856715Z","type":"status","status":"in_progress","notes":"Investigating gemini parser JSON handling"}
{"id":"7fae3aa2","ts":"2026-01-17T04:12:16.420184Z","type":"status","status":"done","resolution":"completed","notes":"Added 'response' to gemini parser field list. Added test case for gemini CLI JSON format."}
{"id":"f94952f8","ts":"2026-01-17T04:15:57.148798Z","type":"status","status":"done","resolution":"completed","notes":"Verified end-to-end: 25 findings in 1m33s. Works but noisy - needs prompt tuning."}
{"id":"e9e04fdf","ts":"2026-01-17T04:15:59.667515Z","type":"status","status":"done","resolution":"completed","notes":"Verified end-to-end: 8 findings in 1m45s. Good signal-to-noise after parser fix for response field."}
{"id":"fb3ab77f","ts":"2026-01-17T13:58:08.995071Z","type":"status","status":"in_progress","notes":"Decoupling prompts for independent tuning"}
{"id":"fb3ab77f","ts":"2026-01-17T14:05:48.658242Z","type":"status","status":"done","resolution":"completed","notes":"Prompts decoupled - DefaultGeminiPrompt is now independent constant. Updated test to reflect decoupling."}
{"id":"c789a356","ts":"2026-01-17T15:16:41.785717Z","type":"status","status":"in_progress"}
{"id":"c789a356","ts":"2026-01-17T15:48:33.938241Z","type":"update","notes":"Baseline complete: Codex 4/1FP (25%), Gemini 6/3FP (50%), Claude 20/16FP (80%). Claude needs tuning to reduce noise."}
{"id":"c789a356","ts":"2026-01-17T16:06:43.685335Z","type":"status","status":"done","resolution":"completed","notes":"Tuned Claude v3 prompt: 11 findings, 73% FP. All agents finding real bugs ~75% of time. Baselines documented in docs/prompt-tuning-log.md. Knowledge applies to eval framework design."}
{"id":"6c2b2ee0","ts":"2026-01-17T16:06:45.43517Z","type":"update","notes":"Insights from c789a356 tuning: need FP tracking, cross-agent comparison, baseline logging. See docs/TUNING.md and docs/prompt-tuning-log.md for methodology."}
{"id":"f98d8feb","ts":"2026-01-17T16:08:18.299854Z","type":"status","status":"in_progress"}
{"id":"f98d8feb","ts":"2026-01-17T16:14:58.511476Z","type":"status","status":"done","resolution":"completed","notes":"Custom prompts work for Claude and Gemini. Codex bug confirmed: custom prompt drops diff context (see caaf71b4). --prompt and --prompt-file flags both functional."}
{"id":"caaf71b4","ts":"2026-01-17T16:15:05.540073Z","type":"update","notes":"Confirmed via f98d8feb testing: Codex custom prompt sends only prompt text without git diff. Claude/Gemini work correctly."}
{"id":"caaf71b4","ts":"2026-01-17T16:15:26.941522Z","type":"update","notes":"Evidence: internal/agent/codex.go:47-51 - when CustomPrompt is set, cmd.Stdin = bytes.NewReader(config.CustomPrompt) without calling GetGitDiff() or BuildPromptWithDiff(). Compare to claude.go:56 and gemini.go:52 which both append diff."}
{"id":"caaf71b4","ts":"2026-01-17T16:16:44.301311Z","type":"status","status":"in_progress"}
{"id":"caaf71b4","ts":"2026-01-17T16:18:54.714762Z","type":"status","status":"done","resolution":"completed","notes":"Fixed in 1fc1fb6. Codex custom prompt now calls GetGitDiff() and BuildPromptWithDiff() like Claude/Gemini. Verified: codex --prompt-file now finds security issues."}
{"id":"tl-1fe744b6","ts":"2026-01-17T16:40:02.125761Z","type":"status","status":"done","resolution":"wontfix","notes":"Premature and probably not necessary. Users can write their own prompts; example templates add maintenance burden without clear value."}
