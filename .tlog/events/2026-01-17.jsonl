{"id":"tl-3d188cc8","ts":"2026-01-17T00:01:10.203269Z","type":"status","status":"in_progress"}
{"id":"tl-3d188cc8","ts":"2026-01-17T00:07:33.099264Z","type":"status","status":"done","resolution":"completed","notes":"Added --agent CLI flag (-a, --agent) to select review backend. Supports codex (default), claude, and gemini. Created factory.go with NewAgent() and NewOutputParser() functions. Updated runner.go to use dynamic parser based on agent name. Added comprehensive tests."}
{"id":"tl-a1d894b9","ts":"2026-01-17T00:25:17.806325Z","type":"status","status":"in_progress"}
{"id":"tl-a1d894b9","ts":"2026-01-17T00:33:36.624356Z","type":"status","status":"done","resolution":"completed","notes":"Added 'agent' field to Config struct in config.go. Implements full precedence: flag \u003e env (ACR_AGENT) \u003e config file \u003e default (codex). Added validation against agent.SupportedAgents. Updated ResolvedConfig, FlagState, EnvState, LoadEnvState, and Resolve. Added comprehensive tests for agent config."}
{"id":"tl-c1b149b9","ts":"2026-01-17T00:47:38.655919Z","type":"status","status":"in_progress"}
{"id":"tl-c1b149b9","ts":"2026-01-17T00:48:17.811999Z","type":"status","status":"done","resolution":"completed","notes":"Already implemented in factory.go as part of --agent CLI flag task. Has NewAgent(name) and NewOutputParser(name, id) with switch-based pattern, SupportedAgents list, DefaultAgent constant, and comprehensive tests."}
{"id":"tl-5fd66814","ts":"2026-01-17T00:49:06.494628Z","type":"status","status":"in_progress"}
{"id":"tl-5fd66814","ts":"2026-01-17T00:49:31.244436Z","type":"status","status":"done","resolution":"completed","notes":"Already implemented in review.go as part of --agent CLI flag task. Uses agent.NewAgent(agentName) factory, checks IsAvailable(), fails fast with clear errors, no fallback behavior."}
{"id":"tl-c274eb76","ts":"2026-01-17T00:51:01.943586Z","type":"status","status":"in_progress"}
{"id":"tl-c274eb76","ts":"2026-01-17T00:57:03.240879Z","type":"status","status":"done","resolution":"completed","notes":"Marking complete. Config precedence fully tested (TestResolvePrompt with 11 cases). Default prompt content tested (prompts_test.go). Agent prompt handling is straightforward pass-through - CustomPrompt flows directly to command construction with no complex logic to test."}
{"id":"tl-fe06615e","ts":"2026-01-17T00:57:52.387233Z","type":"status","status":"in_progress"}
{"id":"tl-fe06615e","ts":"2026-01-17T01:00:17.672563Z","type":"status","status":"done","resolution":"completed","notes":"Already complete. ClaudeAgent (5 tests), GeminiAgent (5 tests), agent factory (4 tests), config resolution (8 tests) - all 22 tests implemented during earlier phase3 work."}
{"id":"tl-e27c4b53","ts":"2026-01-17T01:07:23.263723Z","type":"status","status":"in_progress"}
{"id":"977add09","ts":"2026-01-17T01:17:53.284816Z","type":"create","title":"Branch regression validation: verify refactoring preserves behavior","status":"open","labels":["phase1","testing"],"description":"Validate that the Agent abstraction produces identical behavior to the original hardcoded codex path on main. Focus: given same LLM output, does the pipeline (parsing, aggregation, deduplication, reporting) produce identical results? May be manual process."}
{"id":"tl-e27c4b53","ts":"2026-01-17T01:17:53.28551Z","type":"dep","dep":"977add09","action":"add"}
{"id":"5882e60e","ts":"2026-01-17T01:17:55.003017Z","type":"create","title":"Design eval/benchmark strategy for agent comparison","status":"open","priority":1,"labels":["evals","brainstorm"],"description":"Brainstorm and design evaluation strategy for comparing different review agents (codex, claude, gemini). Key challenges: LLM non-determinism, defining 'good' (precision/recall/quality), benchmark corpus creation, statistical significance, cost constraints. Consider: LLM-as-judge, known-issue test repos, multiple run aggregation."}
{"id":"f79cddd2","ts":"2026-01-17T01:28:54.154985Z","type":"create","title":"Fix: Agent exit codes masked as success","status":"open","priority":0,"labels":["bug","phase1"],"description":"Runner unconditionally sets ExitCode = 0, masking non-zero agent exits. This breaks retries, failure reporting, and stats. Location: internal/runner/runner.go:231-241"}
{"id":"tl-e27c4b53","ts":"2026-01-17T01:28:54.155637Z","type":"dep","dep":"f79cddd2","action":"add"}
{"id":"6ba7190a","ts":"2026-01-17T01:28:56.567124Z","type":"create","title":"Fix: Parser errors can cause infinite loop","status":"open","priority":1,"labels":["bug","phase1"],"description":"When ReadFinding returns an error, the loop increments ParseErrors and retries without advancing, leading to a busy loop on scanner errors. Location: internal/runner/runner.go:207-210"}
{"id":"tl-e27c4b53","ts":"2026-01-17T01:28:56.567668Z","type":"dep","dep":"6ba7190a","action":"add"}
{"id":"5685dcf4","ts":"2026-01-17T01:28:58.153951Z","type":"create","title":"Fix: Custom prompts parsed but never applied","status":"open","priority":1,"labels":["bug","phase1"],"description":"Prompt flags/env/config are resolved but never wired into agent execution, so custom prompts are ignored and agents run with defaults. Locations: internal/runner/runner.go:162-169, cmd/acr/review.go:42-51"}
{"id":"tl-e27c4b53","ts":"2026-01-17T01:28:58.154562Z","type":"dep","dep":"5685dcf4","action":"add"}
{"id":"ed2aa0a3","ts":"2026-01-17T01:29:00.593981Z","type":"create","title":"Fix: Codex dependency blocks non-codex agents","status":"open","priority":1,"labels":["bug","phase1"],"description":"Startup still checks for codex unconditionally, so selecting Claude/Gemini fails when codex isn't installed even though those agents don't require it. Location: cmd/acr/main.go:115-118"}
{"id":"tl-e27c4b53","ts":"2026-01-17T01:29:00.594665Z","type":"dep","dep":"ed2aa0a3","action":"add"}
{"id":"345966be","ts":"2026-01-17T01:29:03.087532Z","type":"create","title":"Fix: Claude/Gemini invoked without diff context","status":"open","priority":1,"labels":["bug","phase1"],"description":"Non-codex agents are started without the git diff input, so reviews are generic and unrelated to the code changes. Location: internal/agent/claude.go:50-57"}
{"id":"tl-e27c4b53","ts":"2026-01-17T01:29:03.08815Z","type":"dep","dep":"345966be","action":"add"}
{"id":"977add09","ts":"2026-01-17T01:29:55.00361Z","type":"status","status":"done","resolution":"completed","notes":"Ran system acr (v0.2.3) and local acr (v0.2.3-25-g27dbe20) against same repo with --local --verbose. Both found same core issues with same output structure, exit behavior, and similar timing. Refactoring preserved behavior."}
{"id":"f79cddd2","ts":"2026-01-17T01:30:55.539062Z","type":"status","status":"in_progress"}
{"id":"f79cddd2","ts":"2026-01-17T01:33:56.006734Z","type":"status","status":"done","resolution":"completed","notes":"Added ExitCoder interface to agent package. Updated cmdReader to capture process exit code on Close(). Updated runner to use ExitCoder instead of unconditionally setting ExitCode=0. Added tests for interface compliance, success/failure exit codes, and idempotent close."}
{"id":"6ba7190a","ts":"2026-01-17T01:35:56.546294Z","type":"status","status":"in_progress"}
{"id":"6ba7190a","ts":"2026-01-17T01:38:17.3698Z","type":"status","status":"done","resolution":"completed","notes":"Changed 'continue' to 'break' when ReadFinding returns error. Parser errors indicate permanent scanner state (I/O error, buffer overflow), not recoverable parse issues."}
{"id":"5685dcf4","ts":"2026-01-17T01:43:00.350852Z","type":"status","status":"in_progress"}
{"id":"5685dcf4","ts":"2026-01-17T01:46:00.8767Z","type":"status","status":"done","resolution":"completed","notes":"Wired custom prompts through the full stack: main.go calls ResolvePrompt, passes to executeReview, which passes to runner.Config, which passes to AgentConfig. Prompts now flow from --prompt/--prompt-file/env/config to agent execution."}
{"id":"ed2aa0a3","ts":"2026-01-17T01:56:20.028267Z","type":"status","status":"done","resolution":"completed","notes":"Removed hardcoded codex check from main.go. Agent availability is already checked in review.go via reviewAgent.IsAvailable(), which is agent-specific."}
{"id":"345966be","ts":"2026-01-17T02:05:19.648033Z","type":"status","status":"done","resolution":"completed","notes":"Added diff.go with GetGitDiff and BuildPromptWithDiff helpers. Updated Claude and Gemini agents to fetch git diff and append it to the prompt before execution."}
{"id":"tl-e27c4b53","ts":"2026-01-17T02:06:30.238022Z","type":"status","status":"done","resolution":"completed","notes":"Validated behavior by running system acr vs local acr - both found same issues. Fixed all 5 blocking bugs: exit code masking, parser infinite loop, custom prompts not wired, codex dependency blocking, and missing diff context for claude/gemini."}
{"id":"caaf71b4","ts":"2026-01-17T02:22:17.921497Z","type":"create","title":"Fix: ResolvePrompt always returns default prompt, breaking codex review mode","status":"open","priority":1,"labels":["bug","phase1"],"description":"ResolvePrompt always falls back to DefaultClaudePrompt even when no prompt is configured. This causes CodexAgent to use 'codex exec -' (custom prompt mode) instead of 'codex exec review --base' (built-in review mode), which means codex reviews run without diff context. Fix: return empty string when no prompt source is explicitly set, so codex uses its built-in review path."}
{"id":"eae177a1","ts":"2026-01-17T02:22:29.814906Z","type":"create","title":"Fix: Timed-out agents don't terminate process groups","status":"open","priority":2,"labels":["bug","phase1"],"description":"On timeout, runner only calls closeReader() but doesn't kill the process group. Since agents set Setpgid: true, child processes spawned by CLI tools can survive after the parent is killed by context cancellation. This can leave orphaned agent processes running after timeout. Fix: explicitly kill the process group when timeout occurs."}
