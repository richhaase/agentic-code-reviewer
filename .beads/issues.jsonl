{"id":"agentic-code-reviewer-kut","title":"FP Filter Improvements","description":"Improve the false positive filter based on research findings from Oracle consultation, production tool patterns, and LLM confidence calibration techniques.\n\n## Goals\n- Better confidence calibration so threshold filtering works reliably\n- Multi-signal approach (not just LLM scoring)\n- Fail-open design for reliability\n- User feedback loop for continuous improvement\n\n## Phases\n1. **Quick Wins** - Prompt improvements, reviewer count signal, never-filter categories\n2. **Reliability** - Fail-open behavior, confidence field, structured output\n3. **Learning** - Historical FP cache, user feedback integration\n4. **Advanced** - Self-consistency sampling, ensemble methods\n\n## Research Sources\n- Oracle architecture review\n- SonarQube, Semgrep, CodeRabbit, GitHub Taskflow patterns\n- LLM confidence calibration research (temperature scaling, few-shot, CoT)\n- LangSmith evaluation patterns","status":"open","priority":2,"issue_type":"epic","owner":"cabe.waldrop1985@gmail.com","created_at":"2026-01-24T12:21:22.337386-07:00","created_by":"cabewaldrop","updated_at":"2026-01-24T12:21:22.337386-07:00"}
{"id":"agentic-code-reviewer-kut.1","title":"PR1: Enhanced FP evaluation prompt with few-shot examples","description":"## Summary\nAdd few-shot examples and chain-of-thought structure to the FP evaluation prompt for better accuracy and calibration.\n\n## Changes\n- Add 3-5 diverse, contrastive few-shot examples to `internal/fpfilter/prompt.go`\n- Add chain-of-thought reasoning requirement (\"Think step-by-step\")\n- Add explicit decision criteria for TRUE_POSITIVE vs FALSE_POSITIVE\n- Request structured output with reasoning field\n\n## Example Structure\n```\nEXAMPLE 1 (Clear FP):\nFinding: \"Consider adding comments\"\nReasoning: Documentation suggestion, not a bug\nfp_score: 90\n\nEXAMPLE 2 (Clear TP):  \nFinding: \"SQL injection via string concatenation\"\nReasoning: Well-known vulnerability pattern\nfp_score: 5\n\nEXAMPLE 3 (Borderline):\nFinding: \"Potential nil pointer on line 42\"\nReasoning: Code checks nil on line 40, likely safe\nfp_score: 75\n```\n\n## Expected Impact\n- +8-12% accuracy improvement\n- Better calibrated confidence scores\n- More consistent evaluations\n\n## Files\n- `internal/fpfilter/prompt.go`\n\n## Effort\n~2 hours","status":"in_progress","priority":2,"issue_type":"feature","owner":"cabe.waldrop1985@gmail.com","created_at":"2026-01-24T12:21:32.788814-07:00","created_by":"cabewaldrop","updated_at":"2026-01-24T12:48:01.598261-07:00","dependencies":[{"issue_id":"agentic-code-reviewer-kut.1","depends_on_id":"agentic-code-reviewer-kut","type":"parent-child","created_at":"2026-01-24T12:21:32.789624-07:00","created_by":"cabewaldrop"}]}
{"id":"agentic-code-reviewer-kut.2","title":"PR2: Add reviewer_count signal to FP evaluation","description":"## Summary\nInclude reviewer agreement (reviewer_count) in the FP evaluation input. Higher reviewer count should bias toward keeping findings.\n\n## Rationale\nIf multiple independent reviewers found the same issue, it's less likely to be a false positive. This signal is already available in `FindingGroup.ReviewerCount` but not passed to the LLM.\n\n## Changes\n- Update `findingInput` struct in `internal/fpfilter/filter.go` to include `ReviewerCount`\n- Update prompt to instruct LLM: \"Higher reviewer_count should bias toward lower fp_score\"\n- Add to few-shot examples showing how reviewer count affects scoring\n\n## Example\n```json\n{\"id\": 0, \"title\": \"...\", \"summary\": \"...\", \"messages\": [...], \"reviewer_count\": 8}\n```\n\nWith 8/10 reviewers finding the same issue, even a borderline case should lean toward keeping.\n\n## Expected Impact\n- Reduces false filtering of high-confidence findings\n- Leverages existing signal at no additional cost\n\n## Files\n- `internal/fpfilter/filter.go`\n- `internal/fpfilter/prompt.go`\n\n## Effort\n~1 hour","status":"open","priority":2,"issue_type":"feature","owner":"cabe.waldrop1985@gmail.com","created_at":"2026-01-24T12:21:42.220983-07:00","created_by":"cabewaldrop","updated_at":"2026-01-24T12:21:42.220983-07:00","dependencies":[{"issue_id":"agentic-code-reviewer-kut.2","depends_on_id":"agentic-code-reviewer-kut","type":"parent-child","created_at":"2026-01-24T12:21:42.221726-07:00","created_by":"cabewaldrop"},{"issue_id":"agentic-code-reviewer-kut.2","depends_on_id":"agentic-code-reviewer-kut.1","type":"blocks","created_at":"2026-01-24T12:23:30.725438-07:00","created_by":"cabewaldrop"}]}
{"id":"agentic-code-reviewer-kut.3","title":"PR3: Never-filter categories for security findings","description":"## Summary\nAdd hardcoded \"never auto-filter\" protection for security-critical finding categories. These should bypass FP filtering entirely.\n\n## Rationale\nSilent false negatives on security issues are far worse than extra noise. Even if the LLM thinks something is a FP, we should never auto-remove security findings.\n\n## Never-Filter Categories\n- Authentication / authorization issues\n- SQL injection / command injection\n- Secrets / credentials exposure\n- XSS / CSRF\n- Path traversal\n- RCE (remote code execution)\n- Cryptography issues\n- Race conditions / deadlocks\n- Nil pointer / null dereference\n- Resource leaks\n- Data loss / corruption\n\n## Implementation\n- Add keyword/pattern matching before LLM evaluation\n- If finding title/summary/messages contain security keywords → skip filtering (fp_score: 0)\n- Log when a finding is protected by never-filter\n\n## Files\n- `internal/fpfilter/filter.go` (add `isSecurityCritical()` function)\n- `internal/fpfilter/categories.go` (new file with category patterns)\n\n## Effort\n~2 hours","status":"open","priority":2,"issue_type":"feature","owner":"cabe.waldrop1985@gmail.com","created_at":"2026-01-24T12:21:51.995361-07:00","created_by":"cabewaldrop","updated_at":"2026-01-24T12:21:51.995361-07:00","dependencies":[{"issue_id":"agentic-code-reviewer-kut.3","depends_on_id":"agentic-code-reviewer-kut","type":"parent-child","created_at":"2026-01-24T12:21:51.996176-07:00","created_by":"cabewaldrop"}]}
{"id":"agentic-code-reviewer-kut.4","title":"PR4: Add confidence field and only filter high-confidence FPs","description":"## Summary\nAdd a confidence field (low/medium/high) to the FP evaluation output. Only auto-filter when BOTH fp_score \u003e= threshold AND confidence == high.\n\n## Rationale\nResearch shows LLM confidence scores are poorly calibrated. A finding with fp_score=80 but confidence=low should not be auto-filtered - there's too much uncertainty.\n\n## Changes\n\n### Output Schema Change\n```json\n{\n  \"evaluations\": [\n    {\n      \"id\": 0,\n      \"fp_score\": 80,\n      \"confidence\": \"high\",  // NEW: low | medium | high\n      \"reasoning\": \"...\"\n    }\n  ]\n}\n```\n\n### Filter Logic Change\n```go\n// Before\nif eval.FPScore \u003e= threshold { remove }\n\n// After\nif eval.FPScore \u003e= threshold \u0026\u0026 eval.Confidence == \"high\" { remove }\n```\n\n### Reporting\n- Show confidence in verbose output\n- Report: \"N findings filtered (high confidence FPs)\"\n- Optionally show \"N findings flagged but kept (low/medium confidence)\"\n\n## Files\n- `internal/fpfilter/filter.go`\n- `internal/fpfilter/prompt.go`\n- `internal/runner/report.go`\n\n## Effort\n~2 hours","status":"open","priority":2,"issue_type":"feature","owner":"cabe.waldrop1985@gmail.com","created_at":"2026-01-24T12:22:01.734672-07:00","created_by":"cabewaldrop","updated_at":"2026-01-24T12:22:01.734672-07:00","dependencies":[{"issue_id":"agentic-code-reviewer-kut.4","depends_on_id":"agentic-code-reviewer-kut","type":"parent-child","created_at":"2026-01-24T12:22:01.735376-07:00","created_by":"cabewaldrop"},{"issue_id":"agentic-code-reviewer-kut.4","depends_on_id":"agentic-code-reviewer-kut.1","type":"blocks","created_at":"2026-01-24T12:23:30.781383-07:00","created_by":"cabewaldrop"}]}
{"id":"agentic-code-reviewer-kut.5","title":"PR5: Fail-open design - never block pipeline on FP filter errors","description":"## Summary\nEnsure the FP filter NEVER blocks the review pipeline. On any error, return unfiltered results with a warning rather than failing.\n\n## Rationale\nThe FP filter is a \"nice to have\" noise reducer, not a critical gate. If it fails, we should show all findings rather than fail the entire review.\n\n## Current Behavior\n- Some errors return (nil, error) which could block\n- Context cancellation handling is inconsistent\n\n## Target Behavior\n- ALL errors result in returning the original findings unfiltered\n- Add `Skipped bool` and `SkipReason string` to Result\n- Log warning: \"FP filter skipped (reason): showing all findings\"\n- Never propagate errors up to caller\n\n## Changes\n```go\ntype Result struct {\n    Grouped      domain.GroupedFindings\n    Removed      []EvaluatedFinding\n    RemovedCount int\n    Duration     time.Duration\n    EvalErrors   int\n    Skipped      bool    // NEW\n    SkipReason   string  // NEW\n}\n```\n\n## Error Cases to Handle\n- Agent creation failure → return original, Skipped=true\n- JSON marshal failure → return original, Skipped=true\n- ExecuteSummary failure → return original, Skipped=true\n- Response parse failure → return original, Skipped=true\n- Context cancellation → return original, Skipped=true\n\n## Files\n- `internal/fpfilter/filter.go`\n- `cmd/acr/review.go` (simplify error handling)\n\n## Effort\n~2 hours","status":"open","priority":2,"issue_type":"feature","owner":"cabe.waldrop1985@gmail.com","created_at":"2026-01-24T12:22:12.99382-07:00","created_by":"cabewaldrop","updated_at":"2026-01-24T12:22:12.99382-07:00","dependencies":[{"issue_id":"agentic-code-reviewer-kut.5","depends_on_id":"agentic-code-reviewer-kut","type":"parent-child","created_at":"2026-01-24T12:22:12.994494-07:00","created_by":"cabewaldrop"},{"issue_id":"agentic-code-reviewer-kut.5","depends_on_id":"agentic-code-reviewer-kut.1","type":"blocks","created_at":"2026-01-24T12:23:30.833764-07:00","created_by":"cabewaldrop"}]}
{"id":"agentic-code-reviewer-kut.6","title":"PR6: Coarse score buckets for better threshold stability","description":"## Summary\nChange FP scoring from continuous 0-100 to coarse buckets (0, 25, 50, 75, 90, 100) for more stable threshold behavior.\n\n## Rationale\nContinuous 0-100 scores create false precision. The LLM can't meaningfully distinguish between fp_score=73 and fp_score=77, but a threshold of 75 would treat them differently.\n\nCoarse buckets:\n- Reduce threshold sensitivity\n- Make scores more interpretable\n- Improve calibration (easier to calibrate 6 values than 100)\n\n## Bucket Definitions\n| Bucket | Meaning |\n|--------|---------|\n| 0 | Definitely true positive - never filter |\n| 25 | Likely true positive |\n| 50 | Uncertain - could go either way |\n| 75 | Likely false positive |\n| 90 | Very likely false positive |\n| 100 | Definitely false positive |\n\n## Changes\n- Update prompt to request bucketed scores\n- Add validation to clamp scores to nearest bucket\n- Update default threshold to 75 (filters 75, 90, 100)\n- Update documentation\n\n## Files\n- `internal/fpfilter/prompt.go`\n- `internal/fpfilter/filter.go`\n\n## Effort\n~2 hours","status":"open","priority":2,"issue_type":"feature","owner":"cabe.waldrop1985@gmail.com","created_at":"2026-01-24T12:22:21.986913-07:00","created_by":"cabewaldrop","updated_at":"2026-01-24T12:22:21.986913-07:00","dependencies":[{"issue_id":"agentic-code-reviewer-kut.6","depends_on_id":"agentic-code-reviewer-kut","type":"parent-child","created_at":"2026-01-24T12:22:21.987619-07:00","created_by":"cabewaldrop"},{"issue_id":"agentic-code-reviewer-kut.6","depends_on_id":"agentic-code-reviewer-kut.4","type":"blocks","created_at":"2026-01-24T12:23:30.882502-07:00","created_by":"cabewaldrop"}]}
{"id":"agentic-code-reviewer-kut.7","title":"PR7: Historical FP cache with semantic matching","description":"## Summary\nCache FP evaluations and use semantic matching to recognize similar findings that were previously evaluated.\n\n## Rationale\n- Avoid re-evaluating identical findings across runs\n- Learn from past evaluations to improve consistency\n- Reduce LLM API costs on repeated reviews\n\n## Implementation\n\n### Cache Key\nHash of: `prompt_version + model + title + summary + messages_hash`\n\n### Cache Storage\n- Local file in repo: `.acr/fp-cache.json`\n- TTL: 30 days (configurable)\n- Max entries: 1000 (LRU eviction)\n\n### Cache Structure\n```json\n{\n  \"version\": 1,\n  \"entries\": {\n    \"\u003chash\u003e\": {\n      \"fp_score\": 80,\n      \"confidence\": \"high\",\n      \"reasoning\": \"...\",\n      \"created_at\": \"2025-01-24T...\",\n      \"prompt_version\": \"v2\"\n    }\n  }\n}\n```\n\n### Flow\n1. Before LLM call, check cache for matching hash\n2. If hit and not expired, use cached result\n3. If miss, call LLM and cache result\n4. Invalidate cache when prompt version changes\n\n## Files\n- `internal/fpfilter/cache.go` (new)\n- `internal/fpfilter/filter.go`\n\n## Effort\n~4 hours","status":"open","priority":2,"issue_type":"feature","owner":"cabe.waldrop1985@gmail.com","created_at":"2026-01-24T12:22:32.588711-07:00","created_by":"cabewaldrop","updated_at":"2026-01-24T12:22:32.588711-07:00","dependencies":[{"issue_id":"agentic-code-reviewer-kut.7","depends_on_id":"agentic-code-reviewer-kut","type":"parent-child","created_at":"2026-01-24T12:22:32.589452-07:00","created_by":"cabewaldrop"},{"issue_id":"agentic-code-reviewer-kut.7","depends_on_id":"agentic-code-reviewer-kut.5","type":"blocks","created_at":"2026-01-24T12:23:30.931757-07:00","created_by":"cabewaldrop"}]}
{"id":"agentic-code-reviewer-kut.8","title":"PR8: User feedback loop - mark findings as FP","description":"## Summary\nAllow users to mark filtered findings as \"actually valid\" or kept findings as \"actually FP\". Use this feedback to improve future filtering.\n\n## Rationale\nUser corrections are ground truth. If users frequently un-hide filtered findings, the threshold is too aggressive. If they frequently mark findings as FP, we can learn those patterns.\n\n## User Flow\n\n### Interactive Mode\n```\n? 1 finding was filtered as likely false positive. Review?\n  [S]how filtered / [C]ontinue\n\nFiltered: \"Consider adding error handling\"\n  fp_score: 85 (high confidence)\n  [K]eep filtered / [R]estore to findings\n```\n\n### Feedback Storage\n```json\n// .acr/fp-feedback.json\n{\n  \"overrides\": [\n    {\n      \"finding_hash\": \"abc123\",\n      \"action\": \"restore\",  // or \"confirm_fp\"\n      \"timestamp\": \"2025-01-24T...\"\n    }\n  ]\n}\n```\n\n### Future Behavior\n- Findings matching override hashes are never auto-filtered\n- Track override rate: if \u003e10% of filtered items get restored, warn user\n- Optionally adjust threshold based on feedback\n\n## CLI Flags\n- `--review-filtered` - Always prompt to review filtered findings\n- `--no-review-filtered` - Never prompt (default in CI)\n\n## Files\n- `internal/fpfilter/feedback.go` (new)\n- `internal/fpfilter/filter.go`\n- `cmd/acr/review.go`\n- `cmd/acr/github_actions.go`\n\n## Effort\n~8 hours","status":"open","priority":2,"issue_type":"feature","owner":"cabe.waldrop1985@gmail.com","created_at":"2026-01-24T12:22:46.755819-07:00","created_by":"cabewaldrop","updated_at":"2026-01-24T12:22:46.755819-07:00","dependencies":[{"issue_id":"agentic-code-reviewer-kut.8","depends_on_id":"agentic-code-reviewer-kut","type":"parent-child","created_at":"2026-01-24T12:22:46.75651-07:00","created_by":"cabewaldrop"},{"issue_id":"agentic-code-reviewer-kut.8","depends_on_id":"agentic-code-reviewer-kut.7","type":"blocks","created_at":"2026-01-24T12:23:30.980944-07:00","created_by":"cabewaldrop"}]}
{"id":"agentic-code-reviewer-kut.9","title":"PR9: Self-consistency sampling for high-stakes findings","description":"## Summary\nFor findings near the threshold (gray zone), use self-consistency sampling: generate N evaluations and use weighted majority vote.\n\n## Rationale\nResearch shows self-consistency with N=5-10 samples improves accuracy by 15-20%. This is expensive, so only use for borderline cases.\n\n## Gray Zone\nFindings with fp_score between `threshold - 10` and `threshold + 10` are in the gray zone. For default threshold=75, that's 65-85.\n\n## Implementation\n\n### Flow\n1. First pass: evaluate all findings normally\n2. Identify gray zone findings (fp_score 65-85)\n3. For gray zone: generate N=3 additional evaluations\n4. Compute confidence-weighted vote\n5. Use consensus score\n\n### Weighted Voting\n```go\n// Each evaluation has score and confidence weight\nweights := map[string]float64{\"high\": 1.0, \"medium\": 0.6, \"low\": 0.3}\n\n// Weighted average of scores\nfinalScore := sum(score * weight) / sum(weights)\n```\n\n### Configuration\n- `--fp-samples N` - Number of samples for gray zone (default: 3)\n- `--no-fp-sampling` - Disable sampling (faster, less accurate)\n- Config: `fp_filter.samples: 3`\n\n## Cost Analysis\n- Normal: 1 LLM call for all findings\n- With sampling: 1 + (gray_zone_count * N) calls\n- Typical: ~2-4x cost increase for borderline cases only\n\n## Files\n- `internal/fpfilter/filter.go`\n- `internal/fpfilter/sampling.go` (new)\n- `internal/config/config.go`\n- `cmd/acr/main.go`\n\n## Effort\n~4 hours","status":"open","priority":2,"issue_type":"feature","owner":"cabe.waldrop1985@gmail.com","created_at":"2026-01-24T12:22:59.482269-07:00","created_by":"cabewaldrop","updated_at":"2026-01-24T12:22:59.482269-07:00","dependencies":[{"issue_id":"agentic-code-reviewer-kut.9","depends_on_id":"agentic-code-reviewer-kut","type":"parent-child","created_at":"2026-01-24T12:22:59.482843-07:00","created_by":"cabewaldrop"},{"issue_id":"agentic-code-reviewer-kut.9","depends_on_id":"agentic-code-reviewer-kut.6","type":"blocks","created_at":"2026-01-24T12:23:31.031631-07:00","created_by":"cabewaldrop"}]}
